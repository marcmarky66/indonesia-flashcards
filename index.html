<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indonesian Flashcards</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3b82f6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Indonesian Flashcards">
    
    <style>
        @media (max-width: 640px) {
            .flashcard-container {
                padding: 1rem;
                margin: 0.5rem;
            }
            .flashcard-text {
                font-size: 1.1rem;
            }
            .button-group {
                flex-direction: column;
                gap: 0.5rem;
            }
            .button-group button {
                width: 100%;
            }
            .control-buttons {
                flex-wrap: wrap;
            }
            .control-buttons button {
                flex: 1;
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Simple icons as SVG components
        const Shuffle = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5"/>
            </svg>
        );
        
        const RotateCcw = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                <path d="M3 3v5h5"/>
            </svg>
        );
        
        const CheckCircle = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                <path d="M9 11l3 3L22 4"/>
            </svg>
        );
        
        const XCircle = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M15 9l-6 6M9 9l6 6"/>
            </svg>
        );
        
        const RotateCw = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"/>
                <path d="M21 3v5h-5"/>
            </svg>
        );
        
        const Edit = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
        );
        
        const Save = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                <path d="M17 21v-8H7v8M7 3v5h8"/>
            </svg>
        );
        
        const Upload = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <path d="M17 8l-5-5-5 5M12 3v12"/>
            </svg>
        );

        const FlexibleIndonesianFlashcards = () => {
            const defaultPhrases = [
                {
                    id: 1,
                    indonesian: "Keringkan sebelum kembali",
                    english: "Dry before returning",
                    hint: null
                },
                {
                    id: 2,
                    indonesian: "Ayam hari ini terlalu keras susah dikunyah",
                    english: "The chicken today is too tough, difficult to chew",
                    hint: null
                },
                {
                    id: 3,
                    indonesian: "Makasih sudah sigap menangani masalah ini",
                    english: "Thank you for quickly handling this problem",
                    hint: null
                }
            ];

            const [phrases, setPhrases] = useState(defaultPhrases);
            const [envelopeTitle, setEnvelopeTitle] = useState("Envelope 1");
            const [isEditing, setIsEditing] = useState(false);
            const [editText, setEditText] = useState("");
            const [currentIndex, setCurrentIndex] = useState(0);
            const [direction, setDirection] = useState('E→I');
            const [userAnswer, setUserAnswer] = useState('');
            const [isFlipped, setIsFlipped] = useState(false);
            const [sessionStats, setSessionStats] = useState({
                correct: 0,
                incorrect: 0,
                total: 0,
                phraseResults: {}
            });
            const [shuffledPhrases, setShuffledPhrases] = useState([]);

            // Initialize shuffled phrases
            useEffect(() => {
                if (phrases.length > 0) {
                    shuffleCards();
                }
            }, [phrases]);

            const shuffleCards = () => {
                if (phrases.length === 0) return;
                const shuffled = [...phrases].sort(() => Math.random() - 0.5);
                setShuffledPhrases(shuffled);
                setCurrentIndex(0);
                setIsFlipped(false);
                setUserAnswer('');
            };

            const switchDirection = () => {
                setDirection(prev => prev === 'E→I' ? 'I→E' : 'E→I');
                setIsFlipped(false);
                setUserAnswer('');
            };

            const resetSession = () => {
                setSessionStats({ correct: 0, incorrect: 0, total: 0, phraseResults: {} });
                shuffleCards();
            };

            const flipCard = () => {
                setIsFlipped(true);
            };

            const markCorrect = () => {
                const currentPhrase = shuffledPhrases[currentIndex];
                setSessionStats(prev => ({
                    correct: prev.correct + 1,
                    incorrect: prev.incorrect,
                    total: prev.total + 1,
                    phraseResults: {
                        ...prev.phraseResults,
                        [currentPhrase.id]: {
                            phrase: currentPhrase,
                            direction: direction,
                            result: 'correct',
                            attempts: (prev.phraseResults[currentPhrase.id]?.attempts || 0) + 1,
                            correct: (prev.phraseResults[currentPhrase.id]?.correct || 0) + 1
                        }
                    }
                }));
                nextCard();
            };

            const markIncorrect = () => {
                const currentPhrase = shuffledPhrases[currentIndex];
                setSessionStats(prev => ({
                    correct: prev.correct,
                    incorrect: prev.incorrect + 1,
                    total: prev.total + 1,
                    phraseResults: {
                        ...prev.phraseResults,
                        [currentPhrase.id]: {
                            phrase: currentPhrase,
                            direction: direction,
                            result: 'incorrect',
                            attempts: (prev.phraseResults[currentPhrase.id]?.attempts || 0) + 1,
                            correct: prev.phraseResults[currentPhrase.id]?.correct || 0
                        }
                    }
                }));
                nextCard();
            };

            const nextCard = () => {
                if (currentIndex < shuffledPhrases.length - 1) {
                    setCurrentIndex(prev => prev + 1);
                } else {
                    shuffleCards();
                }
                setIsFlipped(false);
                setUserAnswer('');
            };

            const startEditing = () => {
                const phrasesText = phrases.map(p => 
                    `${p.indonesian} = ${p.english}${p.hint ? ` (hint: ${p.hint})` : ''}`
                ).join('\n');
                setEditText(phrasesText);
                setIsEditing(true);
            };

            const saveEditing = () => {
                try {
                    const lines = editText.split('\n').filter(line => line.trim());
                    const newPhrases = lines.map((line, index) => {
                        const parts = line.split(' = ');
                        if (parts.length !== 2) throw new Error(`Invalid format on line ${index + 1}`);
                        
                        const indonesian = parts[0].trim();
                        const englishAndHint = parts[1].trim();
                        
                        // Check for hint
                        let english = englishAndHint;
                        let hint = null;
                        const hintMatch = englishAndHint.match(/^(.+?)\s*\(hint:\s*(.+?)\)$/);
                        if (hintMatch) {
                            english = hintMatch[1].trim();
                            hint = hintMatch[2].trim();
                        }
                        
                        return {
                            id: index + 1,
                            indonesian,
                            english,
                            hint
                        };
                    });
                    
                    setPhrases(newPhrases);
                    setIsEditing(false);
                    resetSession();
                } catch (error) {
                    alert(`Error parsing phrases: ${error.message}\n\nFormat should be:\nIndonesian = English\nIndonesian = English (hint: optional hint)`);
                }
            };

            const exportPhrases = () => {
                const phrasesText = phrases.map(p => 
                    `${p.indonesian} = ${p.english}${p.hint ? ` (hint: ${p.hint})` : ''}`
                ).join('\n');
                
                const blob = new Blob([phrasesText], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${envelopeTitle.replace(/\s+/g, '_')}_phrases.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            if (shuffledPhrases.length === 0 && !isEditing) {
                return (
                    <div className="max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-lg text-center flashcard-container">
                        <h1 className="text-2xl font-bold text-gray-800 mb-4">No phrases loaded</h1>
                        <button
                            onClick={startEditing}
                            className="px-6 py-3 bg-blue-500 text-white rounded hover:bg-blue-600"
                        >
                            Add Phrases
                        </button>
                    </div>
                );
            }

            // Editing mode
            if (isEditing) {
                return (
                    <div className="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg flashcard-container">
                        <div className="mb-6">
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                Envelope/Set Title:
                            </label>
                            <input
                                type="text"
                                value={envelopeTitle}
                                onChange={(e) => setEnvelopeTitle(e.target.value)}
                                className="w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500"
                                placeholder="e.g., Envelope 1, Envelope 2, Food Vocabulary, etc."
                            />
                        </div>

                        <div className="mb-6">
                            <label className="block text-sm font-medium text-gray-700 mb-2">
                                Phrases (one per line):
                            </label>
                            <textarea
                                value={editText}
                                onChange={(e) => setEditText(e.target.value)}
                                className="w-full h-96 p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 font-mono text-sm"
                                placeholder={`Format:
Indonesian phrase = English translation
Indonesian phrase = English translation (hint: optional hint)

Example:
Keringkan sebelum kembali = Dry before returning
kamu suka menggambar? = Do you like to draw? (hint: use me-prefix)
Makasih sudah sigap menangani masalah ini = Thank you for quickly handling this problem`}
                            />
                        </div>

                        <div className="flex gap-4 button-group">
                            <button
                                onClick={saveEditing}
                                className="px-6 py-3 bg-green-500 text-white rounded hover:bg-green-600 flex items-center gap-2"
                            >
                                <Save size={16} />
                                Save Phrases
                            </button>
                            <button
                                onClick={() => setIsEditing(false)}
                                className="px-6 py-3 bg-gray-500 text-white rounded hover:bg-gray-600"
                            >
                                Cancel
                            </button>
                        </div>

                        <div className="mt-6 p-4 bg-gray-50 rounded-md text-sm text-gray-600">
                            <h3 className="font-semibold mb-2">Format Instructions:</h3>
                            <ul className="space-y-1">
                                <li>• One phrase per line</li>
                                <li>• Format: Indonesian = English</li>
                                <li>• Optional hints: Indonesian = English (hint: your hint)</li>
                                <li>• Make sure each line has exactly one "=" sign</li>
                                <li>• Empty lines are ignored</li>
                            </ul>
                        </div>
                    </div>
                );
            }

            // Main flashcard interface
            const currentPhrase = shuffledPhrases[currentIndex];
            const promptText = direction === 'E→I' ? currentPhrase.english : currentPhrase.indonesian;
            const answerText = direction === 'E→I' ? currentPhrase.indonesian : currentPhrase.english;
            const accuracy = sessionStats.total > 0 ? Math.round((sessionStats.correct / sessionStats.total) * 100) : 0;

            return (
                <div className="max-w-2xl mx-auto p-6 bg-white rounded-lg shadow-lg flashcard-container">
                    {/* Header */}
                    <div className="text-center mb-6">
                        <div className="flex items-center justify-center gap-2 mb-2">
                            <h1 className="text-2xl font-bold text-gray-800">
                                Indonesian Flashcards - {envelopeTitle}
                            </h1>
                            <button
                                onClick={startEditing}
                                className="p-1 text-gray-500 hover:text-gray-700"
                                title="Edit phrases"
                            >
                                <Edit size={16} />
                            </button>
                        </div>
                        <div className="flex justify-center gap-4 text-sm text-gray-600 flex-wrap">
                            <span>Direction: {direction}</span>
                            <span>Card: {currentIndex + 1}/{shuffledPhrases.length}</span>
                            <span>Accuracy: {accuracy}%</span>
                            <span>Score: {sessionStats.correct}/{sessionStats.total}</span>
                        </div>
                    </div>

                    {/* Controls */}
                    <div className="flex justify-center gap-2 mb-6 control-buttons">
                        <button
                            onClick={switchDirection}
                            className="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 flex items-center gap-2"
                        >
                            <Shuffle size={16} />
                            Switch Direction
                        </button>
                        <button
                            onClick={shuffleCards}
                            className="px-4 py-2 bg-purple-500 text-white rounded hover:bg-purple-600 flex items-center gap-2"
                        >
                            <RotateCw size={16} />
                            Shuffle Cards
                        </button>
                        <button
                            onClick={exportPhrases}
                            className="px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 flex items-center gap-2"
                        >
                            <Upload size={16} />
                            Export
                        </button>
                        <button
                            onClick={resetSession}
                            className="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 flex items-center gap-2"
                        >
                            <RotateCcw size={16} />
                            Reset
                        </button>
                    </div>

                    {/* Flashcard Area */}
                    <div className="border-2 border-gray-200 rounded-lg p-6 mb-4">
                        <div className="text-center mb-4">
                            <p className="text-sm text-gray-500 mb-2">
                                Translate this {direction === 'E→I' ? 'English' : 'Indonesian'} phrase:
                            </p>
                            
                            {/* Hint Display */}
                            {currentPhrase.hint && direction === 'E→I' && (
                                <div className="mb-3 p-2 bg-yellow-100 border border-yellow-300 rounded text-sm text-yellow-800">
                                    <strong>Hint:</strong> {currentPhrase.hint}
                                </div>
                            )}

                            {/* Question Card */}
                            <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-4">
                                <p className="text-xl font-semibold text-gray-800 flashcard-text">
                                    "{promptText}"
                                </p>
                            </div>
                        </div>

                        {/* Answer Input */}
                        <div className="space-y-4">
                            <textarea
                                value={userAnswer}
                                onChange={(e) => setUserAnswer(e.target.value)}
                                placeholder="Type your translation here..."
                                className="w-full p-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                                rows="3"
                            />

                            {/* Answer Card - Initially Hidden */}
                            {!isFlipped ? (
                                <button
                                    onClick={flipCard}
                                    disabled={!userAnswer.trim()}
                                    className="w-full py-4 bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                >
                                    <RotateCw size={20} />
                                    Click to reveal answer
                                </button>
                            ) : (
                                <div className="space-y-4">
                                    {/* Answer Revealed */}
                                    <div className="bg-green-50 border-2 border-green-200 rounded-lg p-4">
                                        <p className="text-lg font-semibold text-gray-800 mb-2">Correct Answer:</p>
                                        <p className="text-xl text-green-800 flashcard-text">"{answerText}"</p>
                                    </div>

                                    {/* Your Answer */}
                                    <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
                                        <p className="text-lg font-semibold text-gray-800 mb-2">Your Answer:</p>
                                        <p className="text-xl text-blue-800 flashcard-text">"{userAnswer}"</p>
                                    </div>

                                    {/* Self-Assessment Buttons */}
                                    <div className="flex gap-4 button-group">
                                        <button
                                            onClick={markCorrect}
                                            className="flex-1 py-3 bg-green-500 text-white rounded-md hover:bg-green-600 flex items-center justify-center gap-2"
                                        >
                                            <CheckCircle size={20} />
                                            Correct ✓
                                        </button>
                                        <button
                                            onClick={markIncorrect}
                                            className="flex-1 py-3 bg-red-500 text-white rounded-md hover:bg-red-600 flex items-center justify-center gap-2"
                                        >
                                            <XCircle size={20} />
                                            Incorrect ✗
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Session Stats */}
                    <div className="text-sm text-gray-600 mb-6">
                        <h3 className="font-semibold mb-2">Session Performance:</h3>
                        <div className="grid grid-cols-3 gap-4 text-center">
                            <div>
                                <p className="text-green-600 font-bold">{sessionStats.correct}</p>
                                <p>Correct</p>
                            </div>
                            <div>
                                <p className="text-red-600 font-bold">{sessionStats.incorrect}</p>
                                <p>Incorrect</p>
                            </div>
                            <div>
                                <p className="text-blue-600 font-bold">{sessionStats.total}</p>
                                <p>Total</p>
                            </div>
                        </div>
                    </div>

                    {/* Detailed Results */}
                    {Object.keys(sessionStats.phraseResults).length > 0 && (
                        <div className="mb-6 p-4 bg-gray-50 rounded-md">
                            <h3 className="font-semibold mb-3 text-gray-800">Detailed Results by Phrase:</h3>
                            <div className="space-y-2">
                                {Object.values(sessionStats.phraseResults).map((result, index) => {
                                    const accuracy = result.attempts > 0 ? Math.round((result.correct / result.attempts) * 100) : 0;
                                    const statusColor = accuracy >= 80 ? 'text-green-600' : accuracy >= 60 ? 'text-yellow-600' : 'text-red-600';
                                    
                                    return (
                                        <div key={index} className="flex justify-between items-center p-2 bg-white rounded border">
                                            <div className="flex-1">
                                                <div className="text-sm font-medium">
                                                    {result.phrase.english}
                                                </div>
                                                <div className="text-xs text-gray-500">
                                                    → {result.phrase.indonesian}
                                                </div>
                                            </div>
                                            <div className={`text-right ${statusColor}`}>
                                                <div className="font-semibold">{accuracy}%</div>
                                                <div className="text-xs">{result.correct}/{result.attempts}</div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                            
                            {/* Envelope Movement Recommendations */}
                            <div className="mt-4 p-3 bg-blue-50 border border-blue-200 rounded">
                                <h4 className="font-semibold text-blue-800 mb-2">Envelope System Recommendations:</h4>
                                <div className="text-sm space-y-1">
                                    {Object.values(sessionStats.phraseResults).map((result, index) => {
                                        const accuracy = result.attempts > 0 ? Math.round((result.correct / result.attempts) * 100) : 0;
                                        if (accuracy >= 80) {
                                            return (
                                                <div key={index} className="text-green-700">
                                                    ✅ "{result.phrase.english}" - Ready for next direction/envelope
                                                </div>
                                            );
                                        } else {
                                            return (
                                                <div key={index} className="text-red-700">
                                                    ❌ "{result.phrase.english}" - Needs more practice in current envelope
                                                </div>
                                            );
                                        }
                                    })}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Instructions */}
                    <div className="mt-6 p-4 bg-gray-50 rounded-md text-sm text-gray-600">
                        <h3 className="font-semibold mb-2">How to use:</h3>
                        <ul className="space-y-1">
                            <li>1. Click the edit button (✏️) to change phrases or envelope title</li>
                            <li>2. Read the phrase and type your translation</li>
                            <li>3. Click "reveal answer" to see the correct translation</li>
                            <li>4. Compare your answer and mark yourself correct ✓ or incorrect ✗</li>
                            <li>5. Use Export button to save your phrase list</li>
                            <li>6. Switch directions to practice both E→I and I→E</li>
                        </ul>
                    </div>
                </div>
            );
        };

        // Render the app
        ReactDOM.render(<FlexibleIndonesianFlashcards />, document.getElementById('root'));
    </script>
</body>
</html>
